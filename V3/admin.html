<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>SCC Admin ‚Äî Form Submissions</title>
<link rel="stylesheet" href="scc_modern.css">
<script src="scc_nav.js"></script>
<style>
  body { font-family: 'Exo 2', system-ui, sans-serif; }

  .admin-wrap {
    max-width: 1100px;
    margin: 32px auto;
    padding: 0 24px;
  }

  .admin-header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    flex-wrap: wrap;
    gap: 12px;
    margin-bottom: 28px;
    padding-bottom: 16px;
    border-bottom: 3px solid #E09000;
  }

  .admin-header h1 {
    font-family: 'Rajdhani', 'Exo 2', sans-serif;
    font-size: 28px;
    font-weight: 700;
    text-transform: uppercase;
    letter-spacing: 0.06em;
    color: #16181f;
    margin: 0;
  }

  .admin-tabs {
    display: flex;
    gap: 8px;
    margin-bottom: 20px;
    flex-wrap: wrap;
  }

  .tab-btn {
    font-family: 'Exo 2', sans-serif;
    font-size: 12px;
    font-weight: 700;
    letter-spacing: 0.07em;
    text-transform: uppercase;
    padding: 7px 18px;
    border-radius: 6px;
    border: 1px solid #d0d4dc;
    background: #fff;
    color: #555;
    cursor: pointer;
    transition: all 0.15s;
  }
  .tab-btn:hover  { background: #f0f2f5; }
  .tab-btn.active { background: #16181f; color: #fff; border-color: #16181f; }

  .action-bar {
    display: flex;
    gap: 10px;
    margin-bottom: 18px;
    flex-wrap: wrap;
    align-items: center;
  }

  .btn {
    font-family: 'Exo 2', sans-serif;
    font-size: 12.5px;
    font-weight: 700;
    letter-spacing: 0.06em;
    text-transform: uppercase;
    padding: 8px 18px;
    border-radius: 6px;
    border: none;
    cursor: pointer;
    transition: opacity 0.15s;
  }
  .btn:hover { opacity: 0.85; }
  .btn-green  { background: linear-gradient(100deg, #006030, #003d1a); color: #fff; }
  .btn-red    { background: linear-gradient(100deg, #C0001A, #8a0010); color: #fff; }
  .btn-grey   { background: #e0e3ea; color: #333; }

  .count-badge {
    font-family: 'Exo 2', sans-serif;
    font-size: 12px;
    font-weight: 700;
    background: #f0f2f5;
    border: 1px solid #d0d4dc;
    border-radius: 999px;
    padding: 3px 10px;
    color: #555;
    margin-left: auto;
  }

  .table-wrap {
    overflow-x: auto;
    border-radius: 10px;
    box-shadow: 0 2px 12px rgba(0,0,0,0.08);
    border: 1px solid #e0e3ea;
  }

  table.data-table {
    width: 100%;
    border-collapse: collapse;
    font-size: 13.5px;
    background: #fff;
  }

  table.data-table thead tr {
    background: #16181f;
    color: #fff;
  }

  table.data-table thead th {
    padding: 10px 13px;
    text-align: left;
    font-weight: 700;
    font-size: 11px;
    letter-spacing: 0.08em;
    text-transform: uppercase;
    white-space: nowrap;
    border: none;
  }

  table.data-table tbody tr:nth-child(even) { background: #f7f8fb; }
  table.data-table tbody tr:hover { background: #eef0f5; }

  table.data-table td {
    padding: 9px 13px;
    border: none;
    border-bottom: 1px solid #eaecf0;
    color: #16181f;
    vertical-align: top;
    max-width: 220px;
    word-break: break-word;
  }

  table.data-table tbody tr:last-child td { border-bottom: none; }

  .badge {
    display: inline-block;
    font-size: 10px;
    font-weight: 800;
    letter-spacing: 0.08em;
    text-transform: uppercase;
    padding: 2px 8px;
    border-radius: 999px;
  }
  .badge-workshop { background: rgba(192,0,26,0.12); color: #8a0010; }
  .badge-intent   { background: rgba(0,56,136,0.12); color: #002a68; }

  .del-btn {
    background: none;
    border: none;
    cursor: pointer;
    color: #bbb;
    font-size: 16px;
    padding: 0 4px;
    line-height: 1;
    transition: color 0.15s;
  }
  .del-btn:hover { color: #C0001A; }

  .empty-state {
    text-align: center;
    padding: 60px 20px;
    color: #8891a0;
    font-size: 15px;
  }
  .empty-state span {
    display: block;
    font-size: 40px;
    margin-bottom: 12px;
  }

  .confirm-bar {
    display: none;
    background: rgba(192,0,26,0.08);
    border: 1px solid rgba(192,0,26,0.2);
    border-radius: 8px;
    padding: 12px 18px;
    margin-bottom: 16px;
    font-size: 13.5px;
    color: #8a0010;
    font-weight: 600;
    align-items: center;
    gap: 12px;
  }
  .confirm-bar.show { display: flex; }
  .confirm-bar button {
    font-family: 'Exo 2', sans-serif;
    font-size: 12px;
    font-weight: 700;
    border: none;
    border-radius: 5px;
    padding: 5px 14px;
    cursor: pointer;
  }
  .confirm-yes { background: #C0001A; color: #fff; }
  .confirm-no  { background: #e0e3ea; color: #333; }
</style>
</head>
<body>
<div class="admin-wrap">

  <div class="admin-header">
    <h1>üìã Form Submissions</h1>
    <a href="index.html" style="font-size:13px;color:#C0001A;font-weight:600;text-decoration:none;">‚Üê Back to Site</a>
  </div>

  <div class="admin-tabs">
    <button class="tab-btn active" onclick="setTab('all')">All</button>
    <button class="tab-btn" onclick="setTab('intent')">Intent to Race</button>
    <button class="tab-btn" onclick="setTab('workshop')">Workshop</button>
  </div>

  <div class="action-bar">
    <button class="btn btn-green" onclick="exportCSV()">‚¨á Download CSV</button>
    <button class="btn btn-grey"  onclick="refreshTable()">‚Üª Refresh</button>
    <button class="btn btn-red"   onclick="showConfirm()">üóë Clear All</button>
    <span class="count-badge" id="countBadge">0 submissions</span>
  </div>

  <div class="confirm-bar" id="confirmBar">
    ‚ö† Are you sure? This will permanently delete all saved submissions.
    <button class="confirm-yes" onclick="clearAll()">Yes, delete all</button>
    <button class="confirm-no"  onclick="hideConfirm()">Cancel</button>
  </div>

  <div class="table-wrap" id="tableWrap"></div>

</div>

<script>
var currentTab = 'all';

var WORKSHOP_COLS = [
  { key: '_submitted',    label: 'Submitted' },
  { key: 'teachname',     label: 'Teacher Name' },
  { key: 'teachemail',    label: 'Teacher Email' },
  { key: 'teachphone',    label: 'Teacher Phone' },
  { key: 'schoolname',    label: 'School' },
  { key: 'schooladdress', label: 'Address' },
  { key: 'attending',     label: '# Attending' }
];

var INTENT_COLS = [
  { key: '_submitted',   label: 'Submitted' },
  { key: 'team',         label: 'Team Name' },
  { key: 'school',       label: 'School' },
  { key: 'street',       label: 'Street' },
  { key: 'city',         label: 'City' },
  { key: 'state',        label: 'State' },
  { key: 'zip',          label: 'Zip' },
  { key: 'country',      label: 'Country' },
  { key: 'school_phone', label: 'School Phone' },
  { key: 'adviser',      label: 'Adviser' },
  { key: 'adviser_phone',label: 'Adviser Phone' },
  { key: 'adviser_email',label: 'Adviser Email' },
  { key: 'captain',      label: 'Captain' },
  { key: 'captain_phone',label: 'Captain Phone' },
  { key: 'captain_email',label: 'Captain Email' },
  { key: 'vehicle',      label: 'Vehicle' },
  { key: 'vehicle_class',label: 'Class' },
  { key: 'webpage',      label: 'Webpage' }
];

var ALL_COLS = [{ key: '_type', label: 'Type' }].concat(INTENT_COLS);

function getData() {
  try { return JSON.parse(localStorage.getItem('scc_submissions') || '[]'); } catch(e) { return []; }
}

function getFiltered() {
  var all = getData();
  if (currentTab === 'all') return all;
  return all.filter(function(r){ return r._type === currentTab; });
}

function getCols() {
  if (currentTab === 'workshop') return WORKSHOP_COLS;
  if (currentTab === 'intent')   return INTENT_COLS;
  // all ‚Äî use combined set
  return ALL_COLS;
}

function setTab(tab) {
  currentTab = tab;
  document.querySelectorAll('.tab-btn').forEach(function(b){
    b.classList.toggle('active', b.textContent.toLowerCase().indexOf(tab === 'all' ? 'all' : tab) >= 0);
  });
  refreshTable();
}

function refreshTable() {
  var rows = getFiltered();
  var cols = getCols();
  var wrap = document.getElementById('tableWrap');
  var badge = document.getElementById('countBadge');
  badge.textContent = rows.length + ' submission' + (rows.length !== 1 ? 's' : '');

  if (rows.length === 0) {
    wrap.innerHTML = '<div class="empty-state"><span>üì≠</span>No submissions yet for this filter.</div>';
    return;
  }

  var html = '<table class="data-table"><thead><tr>';
  cols.forEach(function(c){ html += '<th>' + c.label + '</th>'; });
  html += '<th></th></tr></thead><tbody>';

  rows.forEach(function(row, idx) {
    // find real index in full array for deletion
    var all = getData();
    var realIdx = all.indexOf(row);
    // fallback: match by _submitted + _type
    if (realIdx === -1) {
      realIdx = all.findIndex(function(r){ return r._submitted === row._submitted && r._type === row._type; });
    }

    html += '<tr>';
    cols.forEach(function(c) {
      var val = row[c.key] || '';
      if (c.key === '_type') {
        val = '<span class="badge badge-' + val + '">' + val + '</span>';
      }
      html += '<td>' + escHtml(String(val)).replace(/^<span/, '<span') + '</td>';
    });
    html += '<td><button class="del-btn" title="Delete this row" onclick="deleteRow(' + realIdx + ')">‚úï</button></td>';
    html += '</tr>';
  });

  html += '</tbody></table>';
  wrap.innerHTML = html;
}

function escHtml(s) {
  return s.replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(/"/g,'&quot;');
}

function deleteRow(idx) {
  var all = getData();
  all.splice(idx, 1);
  localStorage.setItem('scc_submissions', JSON.stringify(all));
  refreshTable();
}

function showConfirm() { document.getElementById('confirmBar').classList.add('show'); }
function hideConfirm() { document.getElementById('confirmBar').classList.remove('show'); }

function clearAll() {
  localStorage.removeItem('scc_submissions');
  hideConfirm();
  refreshTable();
}

function exportCSV() {
  var rows = getFiltered();
  var cols = getCols();
  if (rows.length === 0) { alert('No submissions to export.'); return; }

  var lines = [];
  // header
  lines.push(cols.map(function(c){ return '"' + c.label + '"'; }).join(','));
  // rows
  rows.forEach(function(row) {
    lines.push(cols.map(function(c){
      var v = String(row[c.key] || '').replace(/"/g, '""');
      return '"' + v + '"';
    }).join(','));
  });

  var blob = new Blob([lines.join('\r\n')], { type: 'text/csv' });
  var url  = URL.createObjectURL(blob);
  var a    = document.createElement('a');
  var date = new Date().toISOString().slice(0,10);
  a.href     = url;
  a.download = 'scc_' + currentTab + '_submissions_' + date + '.csv';
  a.click();
  URL.revokeObjectURL(url);
}

// init
refreshTable();
</script>
</body>
</html>
